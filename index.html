<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>åƒæ—©ç®—æ•°ã‚¯ã‚¨ã‚¹ãƒˆ - 4å¹´ç”Ÿå°‚ç”¨ç‰ˆ</title>
<style>
body{font-family:Arial,sans-serif;text-align:center;background:#f0f8ff;margin:0;padding:20px}
.monster{font-size:80px;transition:transform 0.3s;margin:20px 0}
.monster.level-up{animation:levelUp 2s}
.monster.correct{animation:correct 1s}
@keyframes levelUp{0%{transform:scale(1)}50%{transform:scale(2)rotate(180deg);color:#ff0}100%{transform:scale(1)rotate(360deg);color:gold}}
@keyframes correct{0%{transform:scale(1)}50%{transform:scale(1.3);color:#0f0}100%{transform:scale(1);color:gold}}
.question{font-size:24px;margin:20px;padding:20px;background:white;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1)}
button{margin:10px;padding:12px 24px;font-size:16px;border:none;border-radius:8px;background:#4CAF50;color:white;cursor:pointer}
button:hover{background:#45a049}
input{font-size:18px;padding:10px;border:2px solid #ddd;border-radius:5px;margin:10px}
.status{margin:15px 0;font-size:18px}
.info{padding:15px;background:white;border-radius:10px;margin:15px 0}
.clear-screen{background:linear-gradient(45deg,#ff9a9e,#fecfef);animation:rainbow 2s infinite}
@keyframes rainbow{0%,100%{background:linear-gradient(45deg,#ff9a9e,#fecfef)}50%{background:linear-gradient(45deg,#a8e6cf,#dcedc1)}}
.gameover{background:#ffebee;color:#d32f2f;padding:20px;border-radius:10px;margin:20px 0}
.position-inputs{display:flex;align-items:center;justify-content:center;gap:10px;margin:20px 0}
.position-inputs span{font-size:18px;margin:0 5px}
.position-inputs input{width:80px;font-size:18px}
.correct-answer{background:#e8f5e8;color:#2e7d32;padding:15px;border-radius:8px;margin:15px 0;font-size:18px;border:2px solid #4caf50}
</style>
</head>
<body>
<h1>ğŸ§® åƒæ—©ç®—æ•°ã‚¯ã‚¨ã‚¹ãƒˆ</h1>

<div id="start">
<h2>å°å­¦4å¹´ç”Ÿã®ç®—æ•°ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã‚ˆã†ï¼</h2>
<div class="info">
<p><strong>ğŸ“š å†…å®¹ï¼š</strong>å°æ•°ã®ç†è§£ãƒ»è¨ˆç®—ãƒ»æ–‡ç« é¡Œï¼ˆ9æ®µéšãƒ¬ãƒ™ãƒ«åˆ¶ï¼‰</p>
<p><strong>ğŸ¯ ç›®æ¨™ï¼š</strong>ãƒ¬ãƒ™ãƒ«9ã§ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ï¼å„ãƒ¬ãƒ™ãƒ«5å•ãšã¤</p>
<p><strong>â¤ï¸ ãƒ«ãƒ¼ãƒ«ï¼š</strong>é–“é•ãˆã‚‹ã¨ä½“åŠ›æ¸›å°‘ã€‚ä½“åŠ›0ã§ã‚²ãƒ¼ãƒ çµ‚äº†</p>
</div>
<div>
<input type="number" id="grade" value="4" min="1" max="6" placeholder="å­¦å¹´">å¹´
<input type="number" id="class" min="1" max="10" placeholder="çµ„">çµ„
<input type="number" id="number" min="1" max="40" placeholder="ç•ªå·">ç•ª
</div>
<button onclick="start()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
</div>

<div id="game" style="display:none">
<div class="info">ãƒ¬ãƒ™ãƒ«<span id="lv">1</span>/9 - <span id="lvInfo"></span></div>
<div class="monster" id="monster">ğŸ¯</div>
<div class="question" id="q"></div>
<div id="answer">
<input type="text" id="input" placeholder="ç­”ãˆã‚’å…¥åŠ›" style="display:block">
<div id="positionInputs" class="position-inputs" style="display:none">
<span>1ã®ä½:</span><input type="number" id="ones" min="0" max="9">
<span>0.1ã®ä½:</span><input type="number" id="tenths" min="0" max="9">
<span>0.01ã®ä½:</span><input type="number" id="hundredths" min="0" max="9">
<span>0.001ã®ä½:</span><input type="number" id="thousandths" min="0" max="9">
</div>
<br><button onclick="submit()">ã“ãŸãˆã‚‹</button>
</div>
<div id="wrong" style="display:none">
<p id="wrongMsg">ã¾ã¡ãŒã„ã§ã™ã€‚ã‚‚ã†ä¸€åº¦è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
<div id="correctAnswerDisplay" class="correct-answer" style="display:none">
<strong>æ­£è§£ï¼š</strong><span id="correctAnswerText"></span>
</div>
<button onclick="retry()">ã‚‚ã†ä¸€åº¦</button>
<button onclick="next()">ã¤ãã¸</button>
</div>
<div class="status">ã‚¹ã‚³ã‚¢: <span id="score">0</span> | HP: <span id="hp">â¤ï¸â¤ï¸â¤ï¸</span></div>
</div>

<div id="gameover" style="display:none" class="gameover">
<h1>ğŸ’€ ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ ğŸ’€</h1>
<div class="monster" style="font-size:120px">ğŸ˜µ</div>
<h2>æ®‹å¿µï¼ä½“åŠ›ãŒ0ã«ãªã‚Šã¾ã—ãŸ</h2>
<div class="info">
<p>åˆ°é”ãƒ¬ãƒ™ãƒ«: <span id="finalLevel"></span>/9</p>
<p>ç²å¾—ã‚¹ã‚³ã‚¢: <span id="finalScore1"></span>ç‚¹</p>
</div>
<button onclick="restart()">ã‚‚ã†ä¸€åº¦</button>
</div>

<div id="clear" style="display:none" class="clear-screen">
<h1>ğŸ‰ ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ï¼ ğŸ‰</h1>
<div class="monster" style="font-size:120px">ğŸ‘‘</div>
<h2>ãŠã‚ã§ã¨ã†ï¼å…¨ãƒ¬ãƒ™ãƒ«åˆ¶è¦‡ï¼</h2>
<div class="info">æœ€çµ‚ã‚¹ã‚³ã‚¢: <span id="finalScore2"></span>ç‚¹</div>
<button onclick="restart()">ã‚‚ã†ä¸€åº¦</button>
</div>

<script>
const $=id=>document.getElementById(id);
let score=0,level=1,hp=3,ans,qNum=0,info="",currentProblem;
const monsters=["ğŸ¯","ğŸŒŸ","ğŸ’","ğŸ¨","ğŸª","ğŸ­","ğŸµ","ğŸ¸","ğŸ²"];
const levelNames=["å˜ä½å¤‰æ›(kgâ†’g)","å°æ•°ã®ä½","å°æ•°ã®å¤§å°","10å€","1/10","å°æ•°ã®æ§‹æˆ","è¶³ã—ç®—","å¼•ãç®—","å°æ•°æ–‡ç« é¡Œ"];

// ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å€¤ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
function rand(min,max,decimals=0){
const num=Math.random()*(max-min)+min;
return decimals?parseFloat(num.toFixed(decimals)):Math.floor(num);
}

// å•é¡Œç”Ÿæˆé–¢æ•°
function generateProblem(level){
switch(level){
case 1: // å˜ä½å¤‰æ›
const kg=rand(1,9);
const g=rand(1,999);
return {
q:`${kg}kg${g}gã‚’kgã§è¡¨ã—ã¾ã—ã‚‡ã†`,
a:(kg+g/1000).toFixed(3).replace(/\.?0+$/,'')
};

case 2: // å°æ•°ã®ä½
const ones=rand(1,9);
const tenths=rand(0,9);
const hundredths=rand(0,9);
const thousandths=rand(0,9);
return {
q:`${ones}.${tenths}${hundredths}${thousandths}ã¯1ã‚’ä½•å€‹ã€0.1ã‚’ä½•å€‹ã€0.01ã‚’ä½•å€‹ã€0.001ã‚’ä½•å€‹é›†ã‚ãŸæ•°ã§ã—ã‚‡ã†ï¼Ÿ`,
a:`${ones},${tenths},${hundredths},${thousandths}`,
type:'position'
};

case 3: // å°æ•°ã®å¤§å°
const a1=rand(10,99)/10;
const a2=a1+(rand(0,1)?0.01:-0.01)*rand(1,5);
const smaller=Math.min(a1,a2);
const question=rand(0,1)?"å°ã•ã„ã»ã†":"å¤§ãã„ã»ã†";
const answer=question==="å°ã•ã„ã»ã†"?smaller:Math.max(a1,a2);
return {
q:`${a1}ã¨${a2}ã§${question}ã‚’é¸ã³ã¾ã—ã‚‡ã†`,
a:answer.toFixed(2).replace(/\.?0+$/,'')
};

case 4: // 10å€
const base=rand(1,999)/100;
return {
q:`${base}ã‚’10å€ã—ãŸæ•°ã¯ã„ãã¤ã§ã—ã‚‡ã†ï¼Ÿ`,
a:(base*10).toFixed(3).replace(/\.?0+$/,'')
};

case 5: // 1/10
const base5=rand(10,999)/10;
return {
q:`${base5}ã‚’ååˆ†ã®ä¸€ã«ã—ãŸæ•°ã¯ã„ãã¤ã§ã—ã‚‡ã†ï¼Ÿ`,
a:(base5/10).toFixed(3).replace(/\.?0+$/,'')
};

case 6: // å°æ•°ã®æ§‹æˆï¼ˆå°æ•°ç¬¬äºŒä½ï½ä¸‰ä½ã¾ã§æ‹¡å¼µï¼‰
const unitType=rand(0,2); // 0:0.1, 1:0.01, 2:0.001
let unit, unitText, count, decimal;

if(unitType===0){
// 0.1ã‚’ä½¿ã£ãŸå•é¡Œ
unit=0.1;
unitText="0.1";
count=rand(10,999); // 10ï½999å€‹
decimal=count*0.1;
}else if(unitType===1){
// 0.01ã‚’ä½¿ã£ãŸå•é¡Œ
unit=0.01;
unitText="0.01";
count=rand(100,999); // 100ï½999å€‹
decimal=count*0.01;
}else{
// 0.001ã‚’ä½¿ã£ãŸå•é¡Œ
unit=0.001;
unitText="0.001";
count=rand(100,999); // 100ï½999å€‹
decimal=count*0.001;
}

return {
q:`${decimal.toFixed(3).replace(/\.?0+$/,'')}ã¯${unitText}ã‚’ã„ãã¤é›†ã‚ãŸæ•°ã§ã—ã‚‡ã†ï¼Ÿ`,
a:count.toString()
};

case 7: // è¶³ã—ç®—
const add1=rand(100,999)/100;
const add2=rand(100,999)/100;
return {
q:`${add1} + ${add2} =`,
a:(add1+add2).toFixed(3).replace(/\.?0+$/,'')
};

case 8: // å¼•ãç®—
const sub1=rand(500,999)/100;
const sub2=rand(100,400)/100;
return {
q:`${sub1} - ${sub2} =`,
a:(sub1-sub2).toFixed(3).replace(/\.?0+$/,'')
};

case 9: // å°æ•°ã®æ–‡ç« é¡Œ
const problems=[
()=>{
// é•·ã•ã®å•é¡Œï¼ˆãƒªãƒœãƒ³ã‚„ã²ã‚‚ï¼‰
const ribbon1=rand(15,35)/10; // 1.5ï½3.5m
const ribbon2=rand(10,25)/10; // 1.0ï½2.5m
const operation=rand(0,1);
if(operation===0){
return {
q:`èµ¤ã„ãƒªãƒœãƒ³ã®é•·ã•ã¯${ribbon1}mã€é’ã„ãƒªãƒœãƒ³ã®é•·ã•ã¯${ribbon2}mã§ã™ã€‚2æœ¬ã®ãƒªãƒœãƒ³ã‚’ã¤ãªã’ã‚‹ã¨å…¨éƒ¨ã§ä½•mã«ãªã‚Šã¾ã™ã‹ï¼Ÿ`,
a:(ribbon1+ribbon2).toFixed(1).replace(/\.?0+$/,'')
};
}else{
const longer=Math.max(ribbon1,ribbon2);
const shorter=Math.min(ribbon1,ribbon2);
return {
q:`é•·ã„ãƒªãƒœãƒ³ã¯${longer}mã€çŸ­ã„ãƒªãƒœãƒ³ã¯${shorter}mã§ã™ã€‚é•·ã„ãƒªãƒœãƒ³ã¯çŸ­ã„ãƒªãƒœãƒ³ã‚ˆã‚Šä½•mé•·ã„ã§ã™ã‹ï¼Ÿ`,
a:(longer-shorter).toFixed(1).replace(/\.?0+$/,'')
};
}
},
()=>{
// é‡ã•ã®å•é¡Œï¼ˆkgå˜ä½ã®å°æ•°ï¼‰
const weight1=rand(15,45)/10; // 1.5ï½4.5kg
const weight2=rand(8,25)/10;  // 0.8ï½2.5kg
const operation=rand(0,1);
if(operation===0){
return {
q:`ã‚Šã‚“ã”ã®é‡ã•ã¯${weight1}kgã€ã¿ã‹ã‚“ã®é‡ã•ã¯${weight2}kgã§ã™ã€‚ã‚Šã‚“ã”ã¨ã¿ã‹ã‚“ã‚’åˆã‚ã›ã‚‹ã¨ä½•kgã«ãªã‚Šã¾ã™ã‹ï¼Ÿ`,
a:(weight1+weight2).toFixed(1).replace(/\.?0+$/,'')
};
}else{
const heavier=Math.max(weight1,weight2);
const lighter=Math.min(weight1,weight2);
return {
q:`é‡ã„è·ç‰©ã¯${heavier}kgã€è»½ã„è·ç‰©ã¯${lighter}kgã§ã™ã€‚é‡ã„è·ç‰©ã¯è»½ã„è·ç‰©ã‚ˆã‚Šä½•kgé‡ã„ã§ã™ã‹ï¼Ÿ`,
a:(heavier-lighter).toFixed(1).replace(/\.?0+$/,'')
};
}
},
()=>{
// æ¶²ä½“ã®å•é¡Œï¼ˆLå˜ä½ã®å°æ•°ï¼‰
const liquid1=rand(12,38)/10; // 1.2ï½3.8L
const liquid2=rand(8,22)/10;  // 0.8ï½2.2L
const operation=rand(0,1);
if(operation===0){
return {
q:`å¤§ãã„ãƒšãƒƒãƒˆãƒœãƒˆãƒ«ã«ã¯${liquid1}Lã€å°ã•ã„ãƒšãƒƒãƒˆãƒœãƒˆãƒ«ã«ã¯${liquid2}Lã®æ°´ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚2æœ¬åˆã‚ã›ã‚‹ã¨ä½•Lã«ãªã‚Šã¾ã™ã‹ï¼Ÿ`,
a:(liquid1+liquid2).toFixed(1).replace(/\.?0+$/,'')
};
}else{
const more=Math.max(liquid1,liquid2);
const less=Math.min(liquid1,liquid2);
return {
q:`å®¹å™¨Aã«ã¯${more}Lã€å®¹å™¨Bã«ã¯${less}Lã®æ°´ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚å®¹å™¨Aã®æ–¹ãŒä½•Lå¤šã„ã§ã™ã‹ï¼Ÿ`,
a:(more-less).toFixed(1).replace(/\.?0+$/,'')
};
}
},
()=>{
// æ™‚é–“ã®å•é¡Œï¼ˆæ™‚é–“å˜ä½ã®å°æ•°ï¼‰
const time1=rand(12,35)/10; // 1.2ï½3.5æ™‚é–“
const time2=rand(8,25)/10;  // 0.8ï½2.5æ™‚é–“
return {
q:`å®¿é¡Œã‚’ã™ã‚‹ã®ã«${time1}æ™‚é–“ã€èª­æ›¸ã‚’ã™ã‚‹ã®ã«${time2}æ™‚é–“ã‹ã‹ã‚Šã¾ã—ãŸã€‚å…¨éƒ¨ã§ä½•æ™‚é–“å‹‰å¼·ã—ã¾ã—ãŸã‹ï¼Ÿ`,
a:(time1+time2).toFixed(1).replace(/\.?0+$/,'')
};
},
()=>{
// è·é›¢ã®å•é¡Œï¼ˆkmå˜ä½ã®å°æ•°ï¼‰
const dist1=rand(15,45)/10; // 1.5ï½4.5km
const dist2=rand(8,28)/10;  // 0.8ï½2.8km
const operation=rand(0,1);
if(operation===0){
return {
q:`å­¦æ ¡ã¾ã§${dist1}kmã€å›³æ›¸é¤¨ã¾ã§${dist2}kmæ­©ãã¾ã—ãŸã€‚å…¨éƒ¨ã§ä½•kmæ­©ã„ãŸã§ã—ã‚‡ã†ã‹ï¼Ÿ`,
a:(dist1+dist2).toFixed(1).replace(/\.?0+$/,'')
};
}else{
const longer=Math.max(dist1,dist2);
const shorter=Math.min(dist1,dist2);
return {
q:`é ã„é“ã®ã‚Šã¯${longer}kmã€è¿‘ã„é“ã®ã‚Šã¯${shorter}kmã§ã™ã€‚é ã„é“ã®ã‚Šã¯è¿‘ã„é“ã®ã‚Šã‚ˆã‚Šä½•kmé•·ã„ã§ã™ã‹ï¼Ÿ`,
a:(longer-shorter).toFixed(1).replace(/\.?0+$/,'')
};
}
}
];
return problems[rand(0,problems.length-1)]();
}
}

function start(){
const g=$("grade").value||"4",c=$("class").value||"ï¼Ÿ",n=$("number").value||"ï¼Ÿ";
info=`${g}å¹´${c}çµ„${n}ç•ª`;
$("start").style.display="none";
$("game").style.display="block";
score=0;level=1;hp=3;qNum=0;
updateDisplay();
nextQ();
}

function updateDisplay(){
$("lv").textContent=level;
$("lvInfo").textContent=levelNames[level-1];
$("score").textContent=score;
$("hp").innerHTML="â¤ï¸".repeat(hp)||"ğŸ’€";
$("monster").textContent=monsters[level-1];
}

function nextQ(){
if(qNum>=5){
if(level>=9){showClear();return}
level++;qNum=0;
$("monster").classList.add("level-up");
setTimeout(()=>$("monster").classList.remove("level-up"),2000);
}

currentProblem=generateProblem(level);
$("q").textContent=currentProblem.q;
ans=currentProblem.a;

// ãƒ¬ãƒ™ãƒ«2ã®å ´åˆã¯ä½ã”ã¨ã®å…¥åŠ›æ¬„ã‚’è¡¨ç¤º
if(level===2){
$("input").style.display="none";
$("positionInputs").style.display="flex";
$("ones").value="";
$("tenths").value="";
$("hundredths").value="";
$("thousandths").value="";
$("ones").focus();
}else{
$("input").style.display="block";
$("positionInputs").style.display="none";
$("input").value="";
$("input").focus();
}

$("answer").style.display="block";
$("wrong").style.display="none";
$("correctAnswerDisplay").style.display="none";
updateDisplay();
}

function submit(){
let userAns;
if(level===2){
const ones=$("ones").value||"0";
const tenths=$("tenths").value||"0";
const hundredths=$("hundredths").value||"0";
const thousandths=$("thousandths").value||"0";
userAns=`${ones},${tenths},${hundredths},${thousandths}`;
}else{
userAns=$("input").value.trim();
}

if(userAns===ans){
score++;qNum++;
$("monster").classList.add("correct");
setTimeout(()=>$("monster").classList.remove("correct"),1000);
setTimeout(nextQ,1500);
}else{
hp--;
if(hp<=0){
showGameOver();
}else{
$("answer").style.display="none";
$("wrong").style.display="block";
$("correctAnswerDisplay").style.display="none";
}
}
}

function retry(){
$("answer").style.display="block";
$("wrong").style.display="none";
$("correctAnswerDisplay").style.display="none";
if(level===2){
$("ones").focus();
}else{
$("input").focus();
}
}

function next(){
// æ­£è§£ã‚’è¡¨ç¤ºã—ã¦ã‹ã‚‰æ¬¡ã®å•é¡Œã¸
displayCorrectAnswer();
setTimeout(() => {
qNum++;
nextQ();
}, 2000);
}

function displayCorrectAnswer(){
let displayAnswer;
if(level===2){
const parts=ans.split(',');
displayAnswer=`1ã®ä½ï¼š${parts[0]}ã€0.1ã®ä½ï¼š${parts[1]}ã€0.01ã®ä½ï¼š${parts[2]}ã€0.001ã®ä½ï¼š${parts[3]}`;
}else{
displayAnswer=ans;
}
$("correctAnswerText").textContent=displayAnswer;
$("correctAnswerDisplay").style.display="block";
}

function showGameOver(){
$("game").style.display="none";
$("gameover").style.display="block";
$("finalLevel").textContent=level;
$("finalScore1").textContent=score;
}

function showClear(){
$("game").style.display="none";
$("clear").style.display="block";
$("finalScore2").textContent=score;
document.body.classList.add("clear-screen");
}

function restart(){
location.reload();
}

$("input").addEventListener("keypress",e=>{if(e.key==="Enter")submit()});
// ãƒ¬ãƒ™ãƒ«2ç”¨ã®ã‚­ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
["ones","tenths","hundredths","thousandths"].forEach(id=>{
$(id).addEventListener("keypress",e=>{if(e.key==="Enter")submit()});
});
</script>
</body>
</html>
