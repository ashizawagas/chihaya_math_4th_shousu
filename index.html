<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>千早算数クエスト - 4年生専用版</title>
<style>
body{font-family:Arial,sans-serif;text-align:center;background:#f0f8ff;margin:0;padding:20px}
.monster{font-size:80px;transition:transform 0.3s;margin:20px 0}
.monster.level-up{animation:levelUp 2s}
.monster.correct{animation:correct 1s}
.monster.wrong{animation:wrong 1s}
@keyframes levelUp{0%{transform:scale(1)}50%{transform:scale(2)rotate(180deg);color:#ff0}100%{transform:scale(1)rotate(360deg);color:gold}}
@keyframes correct{0%{transform:scale(1)}50%{transform:scale(1.3);color:#0f0}100%{transform:scale(1);color:gold}}
@keyframes wrong{0%{transform:scale(1)}25%{transform:scale(1.2);color:#f00}50%{transform:scale(0.8);color:#f44}75%{transform:scale(1.1);color:#f00}100%{transform:scale(1)}}
.question{font-size:24px;margin:20px;padding:20px;background:white;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1)}
button{margin:10px;padding:12px 24px;font-size:16px;border:none;border-radius:8px;background:#4CAF50;color:white;cursor:pointer}
button:hover{background:#45a049}
button.mode-button{background:#2196F3;padding:15px 30px;font-size:18px;margin:15px}
button.mode-button:hover{background:#1976D2}
button.practice{background:#FF9800}
button.practice:hover{background:#F57C00}
button.summary{background:#9C27B0}
button.summary:hover{background:#7B1FA2}
input{font-size:18px;padding:10px;border:2px solid #ddd;border-radius:5px;margin:10px}
.status{margin:15px 0;font-size:18px}
.info{padding:15px;background:white;border-radius:10px;margin:15px 0}
.mode-info{padding:20px;background:#e3f2fd;border-radius:10px;margin:15px 0;border-left:5px solid #2196F3}
.clear-screen{background:linear-gradient(45deg,#ff9a9e,#fecfef);animation:rainbow 2s infinite}
@keyframes rainbow{0%,100%{background:linear-gradient(45deg,#ff9a9e,#fecfef)}50%{background:linear-gradient(45deg,#a8e6cf,#dcedc1)}}
.gameover{background:#ffebee;color:#d32f2f;padding:20px;border-radius:10px;margin:20px 0}
.position-inputs{display:flex;align-items:center;justify-content:center;gap:10px;margin:20px 0}
.position-inputs span{font-size:18px;margin:0 5px}
.position-inputs input{width:80px;font-size:18px}
.correct-answer{background:#e8f5e8;color:#2e7d32;padding:15px;border-radius:8px;margin:15px 0;font-size:18px;border:2px solid #4caf50}
.wrong-feedback{background:#ffebee;color:#d32f2f;padding:15px;border-radius:8px;margin:15px 0;font-size:18px;border:2px solid #f44336}
.input-with-unit{display:inline-flex;align-items:center;gap:5px}
.unit-display{font-size:18px;font-weight:bold;color:#333;background:#f5f5f5;padding:10px 15px;border:2px solid #ddd;border-radius:5px}
.progress{background:#f0f0f0;border-radius:10px;padding:10px;margin:15px 0}
.progress-bar{background:#4CAF50;height:20px;border-radius:10px;transition:width 0.3s}
.streak-counter{font-size:20px;color:#FF5722;font-weight:bold;margin:10px 0}
</style>
</head>
<body>
<h1>🧮 千早算数クエスト</h1>

<div id="start">
<h2>小学4年生の算数をマスターしよう！</h2>
<div class="info">
<p><strong>📚 内容：</strong>小数の理解・計算・文章題（9段階レベル制）</p>
<p><strong>🎯 目標：</strong>レベル9でゲームクリア！</p>
</div>

<h3>モードを選択してください</h3>
<div class="mode-info">
<h4>🔸 練習モード</h4>
<p>・各レベルで5問連続正解でレベルアップ<br>
・間違えても何度でも挑戦可能<br>
・間違えるとそのレベルの連続正解数がリセット</p>
</div>
<div class="mode-info">
<h4>🔸 まとめモード</h4>
<p>・各レベル1問ずつの真剣勝負<br>
・一問でも間違えるとゲームオーバー<br>
・全9レベル制覇を目指そう</p>
</div>

<div>
<input type="number" id="grade" value="4" min="1" max="6" placeholder="学年">年
<input type="number" id="class" min="1" max="10" placeholder="組">組
<input type="number" id="number" min="1" max="40" placeholder="番号">番
</div>

<button class="mode-button practice" onclick="startPractice()">🎓 練習モード</button>
<button class="mode-button summary" onclick="startSummary()">🏆 まとめモード</button>
</div>

<div id="game" style="display:none">
<div class="info">
<span id="modeDisplay"></span> | レベル<span id="lv">1</span>/9 - <span id="lvInfo"></span>
</div>
<div id="practiceProgress" style="display:none">
<div class="progress">
<div class="progress-bar" id="progressBar" style="width:0%"></div>
</div>
<div class="streak-counter">連続正解: <span id="streakCount">0</span>/5</div>
</div>
<div class="monster" id="monster">🎯</div>
<div class="question" id="q"></div>
<div id="answer">
<div id="normalInput">
<div class="input-with-unit">
<input type="text" id="input" placeholder="答えを入力">
<span id="unitDisplay" class="unit-display" style="display:none"></span>
</div>
</div>
<div id="positionInputs" class="position-inputs" style="display:none">
<span>1の位:</span><input type="number" id="ones" min="0" max="9">
<span>0.1の位:</span><input type="number" id="tenths" min="0" max="9">
<span>0.01の位:</span><input type="number" id="hundredths" min="0" max="9">
<span>0.001の位:</span><input type="number" id="thousandths" min="0" max="9">
</div>
<br><button onclick="submit()">こたえる</button>
</div>
<div id="result" style="display:none">
<div id="correctResult" style="display:none">
<div class="correct-answer">🎉 正解です！</div>
</div>
<div id="wrongResult" style="display:none">
<div class="wrong-feedback">❌ 間違いです</div>
<div id="correctAnswerDisplay" class="correct-answer">
<strong>正解：</strong><span id="correctAnswerText"></span>
</div>
</div>
<button id="nextButton" onclick="nextQ()">つぎへ</button>
</div>
<div class="status">スコア: <span id="score">0</span><span id="hpDisplay" style="display:none"> | 残りチャンス: <span id="hp">1</span></span></div>
</div>

<div id="gameover" style="display:none" class="gameover">
<h1>ゲームオーバー</h1>
<div class="monster" style="font-size:120px">😵</div>
<h2 id="gameoverMsg">残念！間違えてしまいました</h2>
<div class="info">
<p>到達レベル: <span id="finalLevel"></span>/9</p>
<p>獲得スコア: <span id="finalScore1"></span>点</p>
</div>
<button onclick="restart()">もう一度</button>
</div>

<div id="clear" style="display:none" class="clear-screen">
<h1>🎉 ゲームクリア！ 🎉</h1>
<div class="monster" style="font-size:120px">👑</div>
<h2>おめでとう！全レベル制覇！</h2>
<div class="info">最終スコア: <span id="finalScore2"></span>点</div>
<button onclick="restart()">もう一度</button>
</div>

<script>
const $=id=>document.getElementById(id);
let score=0,level=1,hp=1,ans,streak=0,info="",currentProblem,currentUnit="",gameMode="";
const monsters=["🎯","🌟","💎","🎨","🎪","🎭","🎵","🎸","🎲"];
const levelNames=["単位変換(kg→g)","小数の位","小数の大小","10倍","1/10","小数の構成","足し算","引き算","小数文章題"];

// ランダムな数値を生成する関数
function rand(min,max,decimals=0){
const num=Math.random()*(max-min)+min;
return decimals?parseFloat(num.toFixed(decimals)):Math.floor(num);
}

// 問題生成関数
function generateProblem(level){
switch(level){
case 1: // 単位変換
const kg=rand(1,9);
const g=rand(1,999);
return {
q:`${kg}kg${g}gをkgで表しましょう`,
a:(kg+g/1000).toFixed(3).replace(/\.?0+$/,''),
unit:"kg"
};

case 2: // 小数の位
const ones=rand(1,9);
const tenths=rand(0,9);
const hundredths=rand(0,9);
const thousandths=rand(0,9);
return {
q:`${ones}.${tenths}${hundredths}${thousandths}は1を何個、0.1を何個、0.01を何個、0.001を何個集めた数でしょう？`,
a:`${ones},${tenths},${hundredths},${thousandths}`,
type:'position'
};

case 3: // 小数の大小
const a1=rand(10,99)/10;
const a2=a1+(rand(0,1)?0.01:-0.01)*rand(1,5);
const smaller=Math.min(a1,a2);
const question=rand(0,1)?"小さいほう":"大きいほう";
const answer=question==="小さいほう"?smaller:Math.max(a1,a2);
return {
q:`${a1}と${a2}で${question}を選びましょう`,
a:answer.toFixed(2).replace(/\.?0+$/,'')
};

case 4: // 10倍
const base=rand(1,999)/100;
return {
q:`${base}を10倍した数はいくつでしょう？`,
a:(base*10).toFixed(3).replace(/\.?0+$/,'')
};

case 5: // 1/10
const base5=rand(10,999)/10;
return {
q:`${base5}を十分の一にした数はいくつでしょう？`,
a:(base5/10).toFixed(3).replace(/\.?0+$/,'')
};

case 6: // 小数の構成
const unitType=rand(0,2);
let unit, unitText, count, decimal;

if(unitType===0){
unit=0.1;
unitText="0.1";
count=rand(10,999);
decimal=count*0.1;
}else if(unitType===1){
unit=0.01;
unitText="0.01";
count=rand(100,999);
decimal=count*0.01;
}else{
unit=0.001;
unitText="0.001";
count=rand(100,999);
decimal=count*0.001;
}

return {
q:`${decimal.toFixed(3).replace(/\.?0+$/,'')}は${unitText}をいくつ集めた数でしょう？`,
a:count.toString(),
unit:"個"
};

case 7: // 足し算
const add1=rand(100,999)/100;
const add2=rand(100,999)/100;
return {
q:`${add1} + ${add2} =`,
a:(add1+add2).toFixed(3).replace(/\.?0+$/,'')
};

case 8: // 引き算
const sub1=rand(500,999)/100;
const sub2=rand(100,400)/100;
return {
q:`${sub1} - ${sub2} =`,
a:(sub1-sub2).toFixed(3).replace(/\.?0+$/,'')
};

case 9: // 小数の文章題
const problems=[
()=>{
const ribbon1=rand(15,35)/10;
const ribbon2=rand(10,25)/10;
const operation=rand(0,1);
if(operation===0){
return {
q:`赤いリボンの長さは${ribbon1}m、青いリボンの長さは${ribbon2}mです。2本のリボンをつなげると全部で何mになりますか？`,
a:(ribbon1+ribbon2).toFixed(1).replace(/\.?0+$/,''),
unit:"m"
};
}else{
const longer=Math.max(ribbon1,ribbon2);
const shorter=Math.min(ribbon1,ribbon2);
return {
q:`長いリボンは${longer}m、短いリボンは${shorter}mです。長いリボンは短いリボンより何m長いですか？`,
a:(longer-shorter).toFixed(1).replace(/\.?0+$/,''),
unit:"m"
};
}
},
()=>{
const weight1=rand(15,45)/10;
const weight2=rand(8,25)/10;
const operation=rand(0,1);
if(operation===0){
return {
q:`りんごの重さは${weight1}kg、みかんの重さは${weight2}kgです。りんごとみかんを合わせると何kgになりますか？`,
a:(weight1+weight2).toFixed(1).replace(/\.?0+$/,''),
unit:"kg"
};
}else{
const heavier=Math.max(weight1,weight2);
const lighter=Math.min(weight1,weight2);
return {
q:`重い荷物は${heavier}kg、軽い荷物は${lighter}kgです。重い荷物は軽い荷物より何kg重いですか？`,
a:(heavier-lighter).toFixed(1).replace(/\.?0+$/,''),
unit:"kg"
};
}
},
()=>{
const liquid1=rand(12,38)/10;
const liquid2=rand(8,22)/10;
const operation=rand(0,1);
if(operation===0){
return {
q:`大きいペットボトルには${liquid1}L、小さいペットボトルには${liquid2}Lの水が入っています。2本合わせると何Lになりますか？`,
a:(liquid1+liquid2).toFixed(1).replace(/\.?0+$/,''),
unit:"L"
};
}else{
const more=Math.max(liquid1,liquid2);
const less=Math.min(liquid1,liquid2);
return {
q:`容器Aには${more}L、容器Bには${less}Lの水が入っています。容器Aの方が何L多いですか？`,
a:(more-less).toFixed(1).replace(/\.?0+$/,''),
unit:"L"
};
}
},
()=>{
const time1=rand(12,35)/10;
const time2=rand(8,25)/10;
return {
q:`宿題をするのに${time1}時間、読書をするのに${time2}時間かかりました。全部で何時間勉強しましたか？`,
a:(time1+time2).toFixed(1).replace(/\.?0+$/,''),
unit:"時間"
};
},
()=>{
const dist1=rand(15,45)/10;
const dist2=rand(8,28)/10;
const operation=rand(0,1);
if(operation===0){
return {
q:`学校まで${dist1}km、図書館まで${dist2}km歩きました。全部で何km歩いたでしょうか？`,
a:(dist1+dist2).toFixed(1).replace(/\.?0+$/,''),
unit:"km"
};
}else{
const longer=Math.max(dist1,dist2);
const shorter=Math.min(dist1,dist2);
return {
q:`遠い道のりは${longer}km、近い道のりは${shorter}kmです。遠い道のりは近い道のりより何km長いですか？`,
a:(longer-shorter).toFixed(1).replace(/\.?0+$/,''),
unit:"km"
};
}
}
];
return problems[rand(0,problems.length-1)]();
}
}

function startPractice(){
gameMode="practice";
startGame();
}

function startSummary(){
gameMode="summary";
startGame();
}

function startGame(){
const g=$("grade").value||"4",c=$("class").value||"？",n=$("number").value||"？";
info=`${g}年${c}組${n}番`;
$("start").style.display="none";
$("game").style.display="block";
score=0;level=1;hp=1;streak=0;
updateDisplay();
nextQ();
}

function updateDisplay(){
$("lv").textContent=level;
$("lvInfo").textContent=levelNames[level-1];
$("score").textContent=score;
$("monster").textContent=monsters[level-1];

if(gameMode==="practice"){
$("modeDisplay").textContent="🎓 練習モード";
$("practiceProgress").style.display="block";
$("hpDisplay").style.display="none";
$("streakCount").textContent=streak;
const progress=(streak/5)*100;
$("progressBar").style.width=progress+"%";
}else{
$("modeDisplay").textContent="🏆 まとめモード";
$("practiceProgress").style.display="none";
$("hpDisplay").style.display="inline";
$("hp").textContent=hp;
}
}

function nextQ(){
// 練習モードでレベルアップチェック
if(gameMode==="practice" && streak>=5){
if(level>=9){showClear();return}
level++;
streak=0;
$("monster").classList.add("level-up");
setTimeout(()=>$("monster").classList.remove("level-up"),2000);
}
// まとめモードでレベルアップチェック
else if(gameMode==="summary" && score>=level){
if(level>=9){showClear();return}
level++;
$("monster").classList.add("level-up");
setTimeout(()=>$("monster").classList.remove("level-up"),2000);
}

currentProblem=generateProblem(level);
$("q").textContent=currentProblem.q;
ans=currentProblem.a;
currentUnit=currentProblem.unit||"";

// レベル2の場合は位ごとの入力欄を表示
if(level===2){
$("normalInput").style.display="none";
$("positionInputs").style.display="flex";
$("ones").value="";
$("tenths").value="";
$("hundredths").value="";
$("thousandths").value="";
$("ones").focus();
}else{
$("normalInput").style.display="block";
$("positionInputs").style.display="none";
$("input").value="";
$("input").focus();
}

// 単位表示の設定
if(currentUnit){
$("unitDisplay").textContent=currentUnit;
$("unitDisplay").style.display="inline-block";
}else{
$("unitDisplay").style.display="none";
}

$("answer").style.display="block";
$("result").style.display="none";
updateDisplay();
}

function submit(){
let userAns;
if(level===2){
const ones=$("ones").value||"0";
const tenths=$("tenths").value||"0";
const hundredths=$("hundredths").value||"0";
const thousandths=$("thousandths").value||"0";
userAns=`${ones},${tenths},${hundredths},${thousandths}`;
}else{
userAns=$("input").value.trim();
}

$("answer").style.display="none";
$("result").style.display="block";

if(userAns===ans){
// 正解
score++;
if(gameMode==="practice"){
streak++;
}
$("monster").classList.add("correct");
setTimeout(()=>$("monster").classList.remove("correct"),1000);
$("correctResult").style.display="block";
$("wrongResult").style.display="none";
}else{
// 不正解
if(gameMode==="practice"){
streak=0; // 連続正解数をリセット
}else{
hp--; // まとめモードでは即ゲームオーバー
}
$("monster").classList.add("wrong");
setTimeout(()=>$("monster").classList.remove("wrong"),1000);
$("correctResult").style.display="none";
$("wrongResult").style.display="block";
displayCorrectAnswer();

if(gameMode==="summary"){
setTimeout(showGameOver,1500);
return;
}
}
updateDisplay();
}

function displayCorrectAnswer(){
let displayAnswer;
if(level===2){
const parts=ans.split(',');
displayAnswer=`1の位：${parts[0]}、0.1の位：${parts[1]}、0.01の位：${parts[2]}、0.001の位：${parts[3]}`;
}else{
displayAnswer=ans+(currentUnit?currentUnit:"");
}
$("correctAnswerText").textContent=displayAnswer;
}

function showGameOver(){
$("game").style.display="none";
$("gameover").style.display="block";
$("finalLevel").textContent=level;
$("finalScore1").textContent=score;
if(gameMode==="summary"){
$("gameoverMsg").textContent="残念！間違えてしまいました";
}
}

function showClear(){
$("game").style.display="none";
$("clear").style.display="block";
$("finalScore2").textContent=score;
document.body.classList.add("clear-screen");
}

function restart(){
location.reload();
}

$("input").addEventListener("keypress",e=>{if(e.key==="Enter")submit()});
["ones","tenths","hundredths","thousandths"].forEach(id=>{
$(id).addEventListener("keypress",e=>{if(e.key==="Enter")submit()});
});
</script>
</body>
</html>
